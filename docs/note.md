# 笔记

## 使用 SSA IR 表示图

深度学习中使用图表示的主要优势是可以自然地表示模型中的数据流和依赖关系。计算图非常直观且易于理解，尤其是对于研究人员和工程师来说，他们需要了解模型的整个结构并对其进行修改和优化。

相比之下，静态单赋值形式（SSA IR）表示的程序是以“语句序列”的形式存在的。使用 SSA IR 表示深度学习模型的主要优势在于其可以有效地进行静态分析和优化。这种优势主要来自以下几点：

1. 一等公民变量以及变量唯一赋值。图中的变量的声明往往不属于程序的一部分，因此没有作用域，也无法分析生命周期。在 SSA IR 中，声明变量是显式的，且每个变量只会被赋值一次。在 SSA IR 中的变量作用域和生命周期分析很简单，有利于对内存分配进行优化。同时，这也方便了编译器进行数据流分析和优化，例如常量传播、死代码删除和代码生成等。

2. 明确的依赖关系。在 SSA IR 中，所有的控制流和数据依赖关系都以显式的方式表示。这使得编译器可以更加准确地了解代码的行为，并在不同的优化阶段中复用不变的代码片段。

3. 容易进行优化。由于 SSA IR 具有上述特点，编译器可以轻松地进行各种优化，例如指令调度、循环展开和代码复制消除等。

4. 容易进行运行分析。图表示的程序中只能存在算子，最多就是给算子排序，而 SSA IR 里可以容纳各种操作，包括硬件的初始化，数据在不同硬件之间同步和传输等。使用 SSA IR 表示的程序更容易分析执行中的细节，有利于实现复杂的运行时行为，例如在同时具有多种异构计算单元的机器上优化。

5. 容易扩展。语句能容纳的格式更灵活，不一定非得是被张量连接起来的算子，更方便实现图算融合优化。子图替换方式的优化也更容易，通过模式识别到可替换的语句，可以直接识别成一个函数。替换就是换一个输入输出相同的函数，再结合函数内联操作就能实现现在的子图替换操作了。

### SSA IR 和图表示是等价的吗？

理论上是，但是需要修改图的定义。图中所谓的“算子”需要定义成任何有输入输出的操作，“张量”需要定义成任何有信息的对象。SSA IR 本身也要求“函数”要无副作用，所以实际上这样修改定义的图只是 SSA IR 的一种结构化的表示而已。

### 为什么仍然需要表示受限的“计算图”？

主要是代码的惯性。另外就是严格遵循算子持有张量，张量连接算子的计算图确实在只需要这些信息就能完成的变换操作中，确实更容易操作，至少不用记录或判断对象是什么了。
